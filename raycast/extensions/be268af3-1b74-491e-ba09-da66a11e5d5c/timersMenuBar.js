"use strict";var D=Object.defineProperty;var J=Object.getOwnPropertyDescriptor;var _=Object.getOwnPropertyNames;var U=Object.prototype.hasOwnProperty;var j=(e,t)=>{for(var n in t)D(e,n,{get:t[n],enumerable:!0})},H=(e,t,n,i)=>{if(t&&typeof t=="object"||typeof t=="function")for(let r of _(t))!U.call(e,r)&&r!==n&&D(e,r,{get:()=>t[r],enumerable:!(i=J(t,r))||i.enumerable});return e};var R=e=>H(D({},"__esModule",{value:!0}),e);var V={};j(V,{default:()=>b});module.exports=R(V);var o=require("@raycast/api"),B=require("react");var $=require("react");var s=require("@raycast/api"),y=require("child_process"),k=require("crypto"),c=require("fs"),O=require("path");var h=e=>{let t=Math.floor(e/3600),n=String(Math.floor(e%3600/60)).padStart(2,"0"),i=String(Math.floor(e%60)).padStart(2,"0");return`${t}:${n}:${i}`};var P=e=>(e.d1=e.d1=="----"?void 0:e.d1,e.d2=e.d2=="----"?void 0:e.d2,Math.round((e.d1?new Date(e.d1):new Date).getTime()-(e.d2?new Date(e.d2):new Date).getTime())/1e3);var p=s.environment.supportPath+"/customTimers.json",w=(e=!1)=>{let t=(0,s.getPreferenceValues)();if(parseFloat(t.volumeSetting)>5){let n="\u26A0\uFE0F Timer alert volume should not be louder than 5 (it can get quite loud!)";return e?(0,s.showHUD)(n):(0,s.showToast)({style:s.Toast.Style.Failure,title:n}),!1}return!0};async function A(e,t="Untitled",n="default"){(0,s.popToRoot)();let r=(s.environment.supportPath+"/"+new Date().toISOString()+"---"+e+".timer").replace(/:/g,"__");(0,c.writeFileSync)(r,t);let l=(0,s.getPreferenceValues)(),T=`${s.environment.assetsPath+"/"+(n==="default"?l.selectedSound:n)}`,d=[`sleep ${e}`];d.push(`if [ -f "${r}" ]; then osascript -e 'display notification "Timer \\"${t}\\" complete" with title "Ding!"'`);let g=`afplay "${T}" --volume ${l.volumeSetting.replace(",",".")}`;if(l.selectedSound==="speak_timer_name"?d.push(`say "${t}"`):d.push(g),l.ringContinuously){let a=`${r}`.replace(".timer",".dismiss");(0,c.writeFileSync)(a,".dismiss file for Timers"),d.push(`while [ -f "${a}" ]; do ${g}; done`)}d.push(`rm "${r}"; else echo "Timer deleted"; fi`),(0,y.exec)(d.join(" && "),(a,M)=>{if(a){console.log(`error: ${a.message}`);return}if(M){console.log(`stderr: ${M}`);return}}),await(0,s.showHUD)(`Timer "${t}" started for ${h(e)}! \u{1F389}`)}function x(e){let t=s.environment.supportPath+"/"+e,n=`if [ -f "${t}" ]; then rm "${t}"; else echo "Timer deleted"; fi`,i=t.replace(".timer",".dismiss"),r=`if [ -f "${i}" ]; then rm "${i}"; else echo "Timer deleted"; fi`;(0,y.execSync)(n),(0,y.execSync)(r)}function F(){let e=[];return(0,c.readdirSync)(s.environment.supportPath).forEach(n=>{if((0,O.extname)(n)==".timer"){let i={name:"",secondsSet:-99,timeLeft:-99,originalFile:n,timeEnds:new Date};i.name=(0,c.readFileSync)(s.environment.supportPath+"/"+n).toString();let r=n.split("---");i.secondsSet=Number(r[1].split(".")[0]);let l=r[0].replace(/__/g,":");i.timeLeft=Math.max(0,Math.round(i.secondsSet-P({d2:l}))),i.timeEnds=new Date(l),i.timeEnds.setSeconds(i.timeEnds.getSeconds()+i.secondsSet),e.push(i)}}),e.sort((n,i)=>n.timeLeft-i.timeLeft),e}function C(){(0,c.existsSync)(p)||(0,c.writeFileSync)(p,JSON.stringify({}))}function L(e){C();let t=JSON.parse((0,c.readFileSync)(p,"utf8"));t[(0,k.randomUUID)()]=e,(0,c.writeFileSync)(p,JSON.stringify(t))}function v(){return C(),JSON.parse((0,c.readFileSync)(p,"utf8"))}function E(e){C();let t=JSON.parse((0,c.readFileSync)(p,"utf8"));delete t[e],(0,c.writeFileSync)(p,JSON.stringify(t))}var S=require("@raycast/api");function I(){let[e,t]=(0,$.useState)(void 0),[n,i]=(0,$.useState)({}),[r,l]=(0,$.useState)(e===void 0),T=()=>{C();let u=F();t(u);let f=v();i(f),l(!1)};return{timers:e,customTimers:n,isLoading:r,refreshTimers:T,handleStartTimer:(u,f,N=!1)=>{w(N)&&(A(u,f),T())},handleStopTimer:u=>{t(e?.filter(f=>f.originalFile!==u.originalFile)),x(u.originalFile),T()},handleStartCT:(u,f=!1)=>{w(f)&&(A(u.timeInSeconds,u.name,u.selectedSound),T())},handleCreateCT:u=>{let f={name:u.name,timeInSeconds:u.secondsSet,selectedSound:"default"};L(f),T()},handleDeleteCT:async u=>{let f={title:"Delete this preset?",icon:S.Icon.Trash,message:"You won't be able to recover it.",dismissAction:{title:"Cancel",style:S.Alert.ActionStyle.Cancel},primaryAction:{title:"Delete",style:S.Alert.ActionStyle.Destructive}};await(0,S.confirmAlert)(f)&&(E(u),T())}}}var m=require("react/jsx-runtime");function b(){let{timers:e,customTimers:t,isLoading:n,refreshTimers:i,handleStartTimer:r,handleStopTimer:l,handleStartCT:T}=I();(0,B.useEffect)(()=>{i(),setInterval(()=>{i()},1e3)},[]),n&&i();let d=(0,o.getPreferenceValues)();if((e==null||e.length==0||e.length==null)&&d.showMenuBarItemWhen!=="always")return null;let g=()=>{if(!(e===void 0||e?.length===0||e.length==null))return d.showTitleInMenuBar?`${e[0].name}: ~${h(e[0].timeLeft)}`:`~${h(e[0].timeLeft)}`};return(0,m.jsxs)(o.MenuBarExtra,{icon:d.showMenuBarItemWhen!=="never"?o.Icon.Clock:void 0,isLoading:n,title:g(),children:[(0,m.jsx)(o.MenuBarExtra.Item,{title:"Click running timer to stop"}),e?.map(a=>(0,m.jsx)(o.MenuBarExtra.Item,{title:a.name+": "+h(a.timeLeft)+" left",onAction:()=>l(a)},a.originalFile)),(0,m.jsx)(o.MenuBarExtra.Section,{children:Object.keys(t)?.sort((a,M)=>t[a].timeInSeconds-t[M].timeInSeconds).map(a=>(0,m.jsx)(o.MenuBarExtra.Item,{title:'Start "'+t[a].name+'"',onAction:()=>T(t[a],!0)},a))}),(0,m.jsxs)(o.MenuBarExtra.Section,{children:[(0,m.jsx)(o.MenuBarExtra.Item,{title:"Start 2 Minute Timer",onAction:()=>r(60*2,"2 Minute Timer",!0)},"2M"),(0,m.jsx)(o.MenuBarExtra.Item,{title:"Start 5 Minute Timer",onAction:()=>r(60*5,"5 Minute Timer",!0)},"5M"),(0,m.jsx)(o.MenuBarExtra.Item,{title:"Start 10 Minute Timer",onAction:()=>r(60*10,"10 Minute Timer",!0)},"10M"),(0,m.jsx)(o.MenuBarExtra.Item,{title:"Start 15 Minute Timer",onAction:()=>r(60*15,"15 Minute Timer",!0)},"15M"),(0,m.jsx)(o.MenuBarExtra.Item,{title:"Start 30 Minute Timer",onAction:()=>r(60*30,"30 Minute Timer",!0)},"30M"),(0,m.jsx)(o.MenuBarExtra.Item,{title:"Start 45 Minute Timer",onAction:()=>r(60*45,"45 Minute Timer",!0)},"45M"),(0,m.jsx)(o.MenuBarExtra.Item,{title:"Start 60 Minute Timer",onAction:()=>r(60*60,"60 Minute Timer",!0)},"60M"),(0,m.jsx)(o.MenuBarExtra.Item,{title:"Start 90 Minute Timer",onAction:()=>r(60*60*1.5,"90 Minute Timer",!0)},"90M")]}),(0,m.jsx)(o.MenuBarExtra.Section,{title:"Custom Timer",children:(0,m.jsx)(o.MenuBarExtra.Item,{title:"Start Custom Timer",onAction:async()=>await(0,o.launchCommand)({name:"startCustomTimer",type:o.LaunchType.UserInitiated})},"custom")})]})}
