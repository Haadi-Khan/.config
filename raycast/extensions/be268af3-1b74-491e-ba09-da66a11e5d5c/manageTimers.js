"use strict";var _=Object.defineProperty;var se=Object.getOwnPropertyDescriptor;var ae=Object.getOwnPropertyNames;var me=Object.prototype.hasOwnProperty;var le=(e,t)=>{for(var o in t)_(e,o,{get:t[o],enumerable:!0})},ce=(e,t,o,s)=>{if(t&&typeof t=="object"||typeof t=="function")for(let a of ae(t))!me.call(e,a)&&a!==o&&_(e,a,{get:()=>t[a],enumerable:!(s=se(t,a))||s.enumerable});return e};var de=e=>ce(_({},"__esModule",{value:!0}),e);var pe={};le(pe,{default:()=>re});module.exports=de(pe);var i=require("@raycast/api"),ne=require("react");var J=require("react");var c=require("@raycast/api"),O=require("child_process"),G=require("crypto"),u=require("fs"),Q=require("path");var A=e=>{let t=Math.floor(e/3600),o=String(Math.floor(e%3600/60)).padStart(2,"0"),s=String(Math.floor(e%60)).padStart(2,"0");return`${t}:${o}:${s}`},q=e=>{let t=new Date(e),o=[t.getFullYear().toString(),t.getMonth().toString().padStart(2,"0"),t.getDate().toString().padStart(2,"0")],s=[t.getHours(),t.getMinutes(),t.getSeconds()].map(f=>f.toString().padStart(2,"0")),a=o.join("-"),p=s.join(":");return`${a} ${p}`},B=e=>(e.d1=e.d1=="----"?void 0:e.d1,e.d2=e.d2=="----"?void 0:e.d2,Math.round((e.d1?new Date(e.d1):new Date).getTime()-(e.d2?new Date(e.d2):new Date).getTime())/1e3);var C=c.environment.supportPath+"/customTimers.json",k=(e=!1)=>{let t=(0,c.getPreferenceValues)();if(parseFloat(t.volumeSetting)>5){let o="\u26A0\uFE0F Timer alert volume should not be louder than 5 (it can get quite loud!)";return e?(0,c.showHUD)(o):(0,c.showToast)({style:c.Toast.Style.Failure,title:o}),!1}return!0};async function v(e,t="Untitled",o="default"){(0,c.popToRoot)();let a=(c.environment.supportPath+"/"+new Date().toISOString()+"---"+e+".timer").replace(/:/g,"__");(0,u.writeFileSync)(a,t);let p=(0,c.getPreferenceValues)(),f=`${c.environment.assetsPath+"/"+(o==="default"?p.selectedSound:o)}`,h=[`sleep ${e}`];h.push(`if [ -f "${a}" ]; then osascript -e 'display notification "Timer \\"${t}\\" complete" with title "Ding!"'`);let D=`afplay "${f}" --volume ${p.volumeSetting.replace(",",".")}`;if(p.selectedSound==="speak_timer_name"?h.push(`say "${t}"`):h.push(D),p.ringContinuously){let T=`${a}`.replace(".timer",".dismiss");(0,u.writeFileSync)(T,".dismiss file for Timers"),h.push(`while [ -f "${T}" ]; do ${D}; done`)}h.push(`rm "${a}"; else echo "Timer deleted"; fi`),(0,O.exec)(h.join(" && "),(T,P)=>{if(T){console.log(`error: ${T.message}`);return}if(P){console.log(`stderr: ${P}`);return}}),await(0,c.showHUD)(`Timer "${t}" started for ${A(e)}! \u{1F389}`)}function z(e){let t=c.environment.supportPath+"/"+e,o=`if [ -f "${t}" ]; then rm "${t}"; else echo "Timer deleted"; fi`,s=t.replace(".timer",".dismiss"),a=`if [ -f "${s}" ]; then rm "${s}"; else echo "Timer deleted"; fi`;(0,O.execSync)(o),(0,O.execSync)(a)}function K(){let e=[];return(0,u.readdirSync)(c.environment.supportPath).forEach(o=>{if((0,Q.extname)(o)==".timer"){let s={name:"",secondsSet:-99,timeLeft:-99,originalFile:o,timeEnds:new Date};s.name=(0,u.readFileSync)(c.environment.supportPath+"/"+o).toString();let a=o.split("---");s.secondsSet=Number(a[1].split(".")[0]);let p=a[0].replace(/__/g,":");s.timeLeft=Math.max(0,Math.round(s.secondsSet-B({d2:p}))),s.timeEnds=new Date(p),s.timeEnds.setSeconds(s.timeEnds.getSeconds()+s.secondsSet),e.push(s)}}),e.sort((o,s)=>o.timeLeft-s.timeLeft),e}function X(e,t){let o=c.environment.supportPath+"/"+e;(0,u.writeFileSync)(o,t)}function b(){(0,u.existsSync)(C)||(0,u.writeFileSync)(C,JSON.stringify({}))}function x(e){b();let t=JSON.parse((0,u.readFileSync)(C,"utf8"));t[(0,G.randomUUID)()]=e,(0,u.writeFileSync)(C,JSON.stringify(t))}function R(){return b(),JSON.parse((0,u.readFileSync)(C,"utf8"))}function Z(e,t){b();let o=JSON.parse((0,u.readFileSync)(C,"utf8"));o[e].name=t,(0,u.writeFileSync)(C,JSON.stringify(o))}function ee(e){b();let t=JSON.parse((0,u.readFileSync)(C,"utf8"));delete t[e],(0,u.writeFileSync)(C,JSON.stringify(t))}var E=require("@raycast/api");function W(){let[e,t]=(0,J.useState)(void 0),[o,s]=(0,J.useState)({}),[a,p]=(0,J.useState)(e===void 0),f=()=>{b();let l=K();t(l);let n=R();s(n),p(!1)};return{timers:e,customTimers:o,isLoading:a,refreshTimers:f,handleStartTimer:(l,n,y=!1)=>{k(y)&&(v(l,n),f())},handleStopTimer:l=>{t(e?.filter(n=>n.originalFile!==l.originalFile)),z(l.originalFile),f()},handleStartCT:(l,n=!1)=>{k(n)&&(v(l.timeInSeconds,l.name,l.selectedSound),f())},handleCreateCT:l=>{let n={name:l.name,timeInSeconds:l.secondsSet,selectedSound:"default"};x(n),f()},handleDeleteCT:async l=>{let n={title:"Delete this preset?",icon:E.Icon.Trash,message:"You won't be able to recover it.",dismissAction:{title:"Cancel",style:E.Alert.ActionStyle.Cancel},primaryAction:{title:"Delete",style:E.Alert.ActionStyle.Destructive}};await(0,E.confirmAlert)(n)&&(ee(l),f())}}}var S=require("@raycast/api");var M=require("@raycast/api");var N=require("fs");var $=M.environment.supportPath+"/raycast-stopwatches.json",ue=()=>{(!(0,N.existsSync)($)||(0,N.readFileSync)($).toString()=="")&&(0,N.writeFileSync)($,"[]")};var te=(e,t)=>{ue();let s=JSON.parse((0,N.readFileSync)($,"utf8")).map(a=>a.swID==e?{...a,name:t}:a);(0,N.writeFileSync)($,JSON.stringify(s))};var L=require("react/jsx-runtime");function V(e){let t=o=>{if(o===""||o===e.currentName)new S.Toast({style:S.Toast.Style.Failure,title:"No new name given!"}).show();else{switch((0,S.popToRoot)(),e.originalFile){case"customTimer":Z(e.ctID?e.ctID:"-99",o);break;case"stopwatch":te(e.ctID?e.ctID:"-99",o);break;default:X(e.originalFile,o);break}new S.Toast({style:S.Toast.Style.Success,title:`Renamed to ${o}!`}).show()}};return(0,L.jsx)(S.Form,{actions:(0,L.jsx)(S.ActionPanel,{children:(0,L.jsx)(S.Action.SubmitForm,{title:"Rename",onSubmit:o=>t(o.newName)})}),children:(0,L.jsx)(S.Form.TextField,{id:"newName",title:"New name",placeholder:e.currentName})})}var d=require("@raycast/api"),U=require("react");var F=require("@raycast/api"),oe=[{title:"Alarm Clock",icon:F.Icon.Alarm,value:"alarmClock.wav"},{title:"Dismembered Woodpecker",icon:F.Icon.Bird,value:"dismemberedWoodpecker.wav"},{title:"Flute Riff",icon:F.Icon.Music,value:"fluteRiff.wav"},{title:"Level Up",icon:F.Icon.Trophy,value:"levelUp.wav"},{title:"Piano Chime",icon:F.Icon.Music,value:"pianoChime.wav"},{title:"Terminator",icon:F.Icon.BarCode,value:"terminator.wav"},{title:"Speak Timer Name",icon:F.Icon.Person,value:"speak_timer_name"}];var w=require("react/jsx-runtime");function j(e){let t=Object.values(e.arguments).some(r=>r!==""),[o,s]=(0,U.useState)(),[a,p]=(0,U.useState)(),[f,h]=(0,U.useState)(),D=(0,d.getPreferenceValues)(),T=r=>{if(b(),r.hours===""&&r.minutes===""&&r.seconds==="")new d.Toast({style:d.Toast.Style.Failure,title:"No values set for timer length!"}).show();else if(isNaN(Number(r.hours)))s("Hours must be a number!");else if(isNaN(Number(r.minutes)))p("Minutes must be a number!");else if(isNaN(Number(r.seconds)))h("Seconds must be a number!");else{if(!k())return;(0,d.closeMainWindow)();let g=r.name?r.name:"Untitled",Y=3600*Number(r.hours)+60*Number(r.minutes)+Number(r.seconds);v(Y,g,r.selectedSound),r.willBeSaved&&x({name:r.name,timeInSeconds:Y,selectedSound:r.selectedSound})}},P=()=>{o&&o.length>0&&s(void 0)},I=()=>{a&&a.length>0&&p(void 0)},l=()=>{f&&f.length>0&&h(void 0)},H=[{id:"hours",title:"Hours",placeholder:"0",err:o,drop:P,validator:r=>{let g=r.target.value;isNaN(Number(g))?s("Hours must be a number!"):P()}},{id:"minutes",title:"Minutes",placeholder:"00",err:a,drop:I,validator:r=>{let g=r.target.value;isNaN(Number(g))?p("Minutes must be a number!"):I()}},{id:"seconds",title:"Seconds",placeholder:"00",err:f,drop:l,validator:r=>{let g=r.target.value;isNaN(Number(g))?h("Seconds must be a number!"):l()}}];return D.newTimerInputOrder!=="hhmmss"&&H.reverse(),(0,w.jsxs)(d.Form,{actions:(0,w.jsx)(d.ActionPanel,{children:(0,w.jsx)(d.Action.SubmitForm,{title:"Start Custom Timer",onSubmit:r=>T(r)})}),children:[H.map((r,g)=>(0,w.jsx)(d.Form.TextField,{id:r.id,title:r.title,placeholder:r.placeholder,defaultValue:e.arguments[r.id],error:r.err,onChange:r.drop,onBlur:r.validator},g)),(0,w.jsxs)(d.Form.Dropdown,{id:"selectedSound",defaultValue:"default",title:"Sound",children:[(0,w.jsx)(d.Form.Dropdown.Item,{value:"default",title:"Default"}),oe.map((r,g)=>(0,w.jsx)(d.Form.Dropdown.Item,{title:r.value===D.selectedSound?`${r.title} (currently selected)`:r.title,value:r.value,icon:r.icon},g))]}),(0,w.jsx)(d.Form.TextField,{id:"name",title:"Name",placeholder:"Pour Tea",autoFocus:t}),(0,w.jsx)(d.Form.Checkbox,{id:"willBeSaved",label:"Save as preset"})]})}var m=require("react/jsx-runtime");function re(e){if(e.launchContext?.timerID){let y=R()[e.launchContext.timerID];if(y==null)(0,i.showToast)({style:i.Toast.Style.Failure,title:"This custom timer no longer exists!"});else{v(y.timeInSeconds,y.name,y.selectedSound);return}}let{timers:t,customTimers:o,isLoading:s,refreshTimers:a,handleStopTimer:p,handleStartCT:f,handleCreateCT:h,handleDeleteCT:D}=W(),{push:T}=(0,i.useNavigation)();(0,ne.useEffect)(()=>{a(),setInterval(()=>{a()},1e3)},[]);let P={tag:{value:"Running",color:i.Color.Yellow}},I={tag:{value:"Finished!",color:i.Color.Green}},l=n=>`raycast://extensions/ThatNerd/timers/manageTimers?context=${encodeURIComponent(JSON.stringify({timerID:n}))}`;return(0,m.jsxs)(i.List,{isLoading:s,children:[(0,m.jsxs)(i.List.Section,{title:t?.length!==0&&t!=null?"Currently Running":"No Timers Running",children:[t?.map(n=>(0,m.jsx)(i.List.Item,{icon:{source:i.Icon.Clock,tintColor:n.timeLeft===0?i.Color.Green:i.Color.Yellow},title:n.name,subtitle:A(n.timeLeft)+" left",accessories:[{text:A(n.secondsSet)+" originally"},{text:`${n.timeLeft===0?"Ended":"Ends"} at ${q(n.timeEnds)}`},n.timeLeft===0?I:P],actions:(0,m.jsxs)(i.ActionPanel,{children:[(0,m.jsx)(i.Action,{title:"Stop Timer",onAction:()=>p(n)}),(0,m.jsx)(i.Action,{title:"Rename Timer",onAction:()=>T((0,m.jsx)(V,{currentName:n.name,originalFile:n.originalFile,ctID:null}))}),(0,m.jsx)(i.Action,{title:"Save Timer as Preset",shortcut:{modifiers:["cmd","shift"],key:"enter"},onAction:()=>h(n)})]})},n.originalFile)),(0,m.jsx)(i.List.Item,{icon:i.Icon.Clock,title:"Create a new timer",subtitle:"Press Enter to start a timer",actions:(0,m.jsx)(i.ActionPanel,{children:(0,m.jsx)(i.Action,{title:"Start Timer",onAction:()=>T((0,m.jsx)(j,{arguments:{hours:"",minutes:"",seconds:""}}))})})},0)]}),(0,m.jsx)(i.List.Section,{title:"Custom Timers",children:Object.keys(o)?.sort((n,y)=>o[n].timeInSeconds-o[y].timeInSeconds).map(n=>(0,m.jsx)(i.List.Item,{icon:i.Icon.Clock,title:o[n].name,subtitle:A(o[n].timeInSeconds),actions:(0,m.jsxs)(i.ActionPanel,{children:[(0,m.jsx)(i.Action,{title:"Start Timer",onAction:()=>f(o[n])}),(0,m.jsx)(i.Action,{title:"Rename Timer",onAction:()=>T((0,m.jsx)(V,{currentName:o[n].name,originalFile:"customTimer",ctID:n}))}),(0,m.jsx)(i.Action,{title:"Delete Custom Timer",shortcut:{modifiers:["ctrl"],key:"x"},onAction:()=>D(n)}),(0,m.jsx)(i.Action.CreateQuicklink,{quicklink:{name:o[n].name,link:l(n)},title:"Add Preset to Root Search"})]})},n))})]})}
